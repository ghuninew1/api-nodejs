<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.png" type="image/png" />
        <link rel="apple-touch-icon" href="/apple-icon-180x180.png" />
        <link rel="manifest" href="/manifest.json" />
        <title>Web Socket</title>
        <link rel="stylesheet" href="./css/mycss.css" />
        <link rel="stylesheet" href="./css/default.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>

    </head>
    <body>
        <main>
            <div class="header">
                <div>
                    Status: <span id="status">Disconnected</span
                    ><span id="statuscol" class="offline"></span>
                </div>
                <div>Transport: <span id="transport">N/A</span></div>
                <p id="res"></p>
            </div>
            <div class="sec">
                <button id="wsconnect" type="button" title="Connect">Connect</button>
                <button id="logout" type="button" title="Simulate logout">Close</button>
                <!-- <button id="wsping" type="button" title="Simulate ping">Ping</button>
                <button id="wsstatus" type="button" title="Simulate cpu">Status</button> -->
            </div>
            <div class="main">
                <div class="container">
                    <div class="content">
                        <div class="header">
                            <div id="span-controls" class="span-controls"></div>
                        </div>
                        <div class="container cpu">
                            <div class="stats-column">
                                <h5>CPU Usage</h5>
                                <h1 id="cpuStat">- %</h1>
                            </div>
                            <div class="chart-container">
                                <canvas id="cpuChart" width="400" height="100"></canvas>
                            </div>
                        </div>
                        <div class="container mem">
                            <div class="stats-column">
                                <h5>Memory Usage</h5>
                                <h1 id="memStat">- %</h1>
                            </div>
                            <div class="chart-container">
                                <canvas id="memChart" width="200" height="100"></canvas>
                            </div>
                        </div>
                        <div class="container heap-size">
                            <div class="stats-column">
                                <h5>Heap Usage</h5>
                                <h1 id="heapStat">- %</h1>
                            </div>
                            <div class="chart-container">
                                <canvas id="heapChart" width="200" height="100"></canvas>
                            </div>
                        </div>
                        <div class="container load">
                            <div class="stats-column">
                                <h5>One Minute Load Avg</h5>
                                <h1 id="loadStat">-</h1>
                            </div>
                            <div class="chart-container">
                                <canvas id="loadChart" width="200" height="100"></canvas>
                            </div>
                        </div>
                        <div class="container eventLoop">
                            <div class="stats-column">
                                <h5>Spent in Event Loop</h5>
                                <h1 id="eventLoopStat">ms</h1>
                            </div>
                            <div class="chart-container">
                                <canvas id="eventLoopChart" width="200" height="100"></canvas>
                            </div>
                        </div>
                        <div class="container responseTime">
                            <div class="stats-column">
                                <h5>Response Time</h5>
                                <h1 id="responseTimeStat">-</h1>
                            </div>
                            <div class="chart-container">
                                <canvas id="responseTimeChart" width="200" height="100"></canvas>
                            </div>
                        </div>
                        <div class="container rps">
                            <div class="stats-column">
                                <h5>Requests per Second</h5>
                                <h1 id="rpsStat">-</h1>
                            </div>
                            <div class="chart-container">
                                <canvas id="rpsChart" width="200" height="100"></canvas>
                            </div>
                        </div>
                        <div class="container statusCodes">
                            <div class="stats-column">
                                <h5>Status Codes</h5>
                                <h6 class="status-code status-code-2xx">2xx</h6>
                                <h6 class="status-code status-code-3xx">3xx</h6>
                                <h6 class="status-code status-code-4xx">4xx</h6>
                                <h6 class="status-code status-code-5xx">5xx</h6>
                            </div>
                            <div class="chart-container">
                                <canvas id="statusCodesChart" width="200" height="100"></canvas>
                            </div>
                        </div>
                        <!-- <div class="container healthChecks">
                            {{#each healthCheckResults}}
                            <div class="health-check-row">
                                <div class="health-check-title-column">
                                    <h5><a href="{{path}}">{{path}}</a></h5>
                                </div>
                                <div class="health-check-status-container {{status}}">
                                    <h1>{{status}}</h1>
                                </div>
                            </div>
                            {{/each}}
                        </div> -->

                    </div>
                </div>
            </div>
            <div class="footer">
                <p>
                    &#9829; @GhuniNew
                </p>
            </div>
        </main>
        <script src="/socket.io/socket.io.min.js"></script>
        <!-- <script>
            const $status = document.getElementById("status");
            const $transport = document.getElementById("transport");
            const statuscol = document.querySelector("#statuscol");
            const wsconnect = document.querySelector("#wsconnect");

            wsconnect.onclick = () => {
                Websockets();
            };

            const Websockets = () => {
                const socket = io({
                    path: "/ws",
                    transports: ["websocket"],
                });

                socket.on("connect", () => {
                    console.log(`connected with transport ${socket.io.engine.transport.name} `);
                    $status.innerText = "Connected";
                    $transport.innerText = socket.io.engine.transport.name;
                    statuscol.classList.add("online");
                    statuscol.classList.remove("offline");

                    socket.io.engine.on("upgrade", (transport) => {
                        console.log(`transport upgraded to ${transport.name}`);

                        $transport.innerText = transport.name;
                    });
                });

                socket.on("message", (data) => {
                    console.log("message", data);
                });
                socket.on("connect_error", (err) => {
                    console.log(`connect_error due to ${err.message}`);
                });

                socket.on("disconnect", (reason) => {
                    console.log(`disconnect due to ${reason}`);
                    $status.innerText = "Disconnected";
                    $transport.innerText = "N/A";
                    statuscol.classList.add("offline");
                    statuscol.classList.remove("online");
                });

                const wslohout = document.querySelector("#logout");
                const wsstatus = document.querySelector("#wsstatus");
                const wsping = document.querySelector("#wsping");

                wslohout.onclick = () => {
                    socket.close();
                };
                // wsstatus.onclick = () => {
                //     checkStatus();
                // };
                // wsping.onclick = () => {
                //     checkPing();
                // };

                const fomateNum = (num) => Number(num).toFixed(2);

                // const checkPing = () => {
                //     console.log("ping");
                //     socket.emit("ping", "pingg");
                // };
                // const checkStatus = () => {
                //     console.log("status");
                //     socket.emit("status", "status");
                // };
            };
        </script> -->
        <script src="./js/app.js"></script>
    </body>
</html>
